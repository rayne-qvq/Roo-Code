branch="$(git rev-parse --abbrev-ref HEAD)"

if [ "$branch" = "main" ]; then
  echo "You can't commit directly to main - please check out a branch."
  exit 1
fi

# 初始化 nvm 并切换 Node 版本
if [ -s "$HOME/.nvm/nvm.sh" ]; then
  . "$HOME/.nvm/nvm.sh"
  nvm use 20.19.2 >/dev/null 2>&1
fi

# Detect if running on Windows and use pnpm.cmd, otherwise use pnpm.
if [ "$OS" = "Windows_NT" ]; then
  pnpm_cmd="pnpm.cmd"
  npx_cmd="npx.cmd"
else
  pnpm_cmd="pnpm"
  npx_cmd="npx"
fi

# 执行 lint-staged 和 lint
$npx_cmd lint-staged
$pnpm_cmd lint
